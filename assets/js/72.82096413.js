(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{348:function(t,_,e){"use strict";e.r(_);var v=e(4),r=Object(v.a)({},function(){var t=this,_=t.$createElement,e=t._self._c||_;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"wechatpay"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wechatpay","aria-hidden":"true"}},[t._v("#")]),t._v(" wechatPay")]),t._v(" "),e("p",[e("strong",[t._v("前言:微信支付")])]),t._v(" "),e("hr"),t._v(" "),e("h1",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("h2",{attrs:{id:"支付模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付模式","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付模式")]),t._v(" "),e("p",[t._v("支持的支付模式")]),t._v(" "),e("ol",[e("li",[t._v("刷卡支付  适用于线下面对面收银场景")]),t._v(" "),e("li",[t._v("扫码支付 商户系统生成支付二维码,无需面对面的支付方式")]),t._v(" "),e("li",[t._v("公众号支付 公众号内调用支付接口完成支付")]),t._v(" "),e("li",[t._v("APP 支付 调用微信 sdk 接口完成支付行为")])]),t._v(" "),e("h2",{attrs:{id:"技术术语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#技术术语","aria-hidden":"true"}},[t._v("#")]),t._v(" 技术术语")]),t._v(" "),e("ul",[e("li",[e("strong",[t._v("微信公众平台")]),t._v(" 微信提供企业服务的轻应用")]),t._v(" "),e("li",[e("strong",[t._v("微信开放平台")]),t._v(" 提供给第三方调用微信接口的能力.为开发者模式")]),t._v(" "),e("li",[e("strong",[t._v("微信商户平台")]),t._v(" 提供微信支付的功能平台")]),t._v(" "),e("li",[e("strong",[t._v("微信企业号")]),t._v(" 不清楚?")]),t._v(" "),e("li",[e("strong",[t._v("微信支付系统")]),t._v(" 实现微信支付等逻辑的系统")]),t._v(" "),e("li",[e("strong",[t._v("商户收银系统")]),t._v(" POS 收银机,用来录入商品信息,生成订单,客户支付,打印小票的机器\n"),e("ul",[e("li",[t._v("需要搞清楚 POS 机软体的运行方式")])])]),t._v(" "),e("li",[e("strong",[t._v("商户后台系统")]),t._v(" 商户后台处理业务逻辑的总称")]),t._v(" "),e("li",[e("strong",[t._v("商户证书")]),t._v(" 提供二进制文件，作为微信支付的后台凭证")]),t._v(" "),e("li",[e("strong",[t._v("签名")]),t._v(" 常用签名算法 MD5,SHA128,SHA256,HMAC")]),t._v(" "),e("li",[e("strong",[t._v("openId")]),t._v(" 用户在公众号下的唯一标识")]),t._v(" "),e("li",[e("strong",[t._v("mch_id")]),t._v(" 微信支付对应的商户 id 号")]),t._v(" "),e("li",[e("strong",[t._v("api 秘钥")]),t._v(" 商户系统和微信后台进行交易的接口秘钥")]),t._v(" "),e("li",[e("strong",[t._v("Appid")]),t._v(" 公众号 id")]),t._v(" "),e("li",[e("strong",[t._v("Appsecret")]),t._v(" 公众号秘钥")])]),t._v(" "),e("p",[t._v("对于开发重点关注的参数如下:")]),t._v(" "),e("p",[e("strong",[t._v("APPID")]),t._v(" 微信服务号对应的识别 id\n"),e("strong",[t._v("mch_id")]),t._v(" 开通微信支付后对应的商户账号\n"),e("strong",[t._v("API 密钥")]),t._v(" 支付交易中的签名密钥,用于微信核对支付信息\n"),e("strong",[t._v("Appsecret")]),t._v(" 调用微信接口的凭证")]),t._v(" "),e("p",[t._v("详情参见 "),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=3_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付账户"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"微信支付协议规范"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信支付协议规范","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信支付协议规范")]),t._v(" "),e("ol",[e("li",[t._v("采用 https 的方式传输")]),t._v(" "),e("li",[t._v("采用 post 方式提交")]),t._v(" "),e("li",[t._v("采用 xml 进行数据交互")]),t._v(" "),e("li",[t._v("采用 utf8 编码")]),t._v(" "),e("li",[t._v("签名算法进行接口验证")]),t._v(" "),e("li",[t._v("签名要求\n"),e("ol",[e("li",[e("p",[t._v("将所有非空的参数按照字典排序生成 stringA")])]),t._v(" "),e("li",[e("p",[t._v("生成摘要")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(' \n   stringSignTemp="stringA&key=192006250b4c09247ec02edce69f6a2d"\n   sign=MD5(stringSignTemp).toUpperCase()="9A0A8659F005D6984697E2CA0A9CF3B7"\n    \n')])])])]),t._v(" "),e("li",[e("p",[t._v("将生成的新字段添加到传入参数中，作为一个新字段\n字段中有一个 "),e("code",[t._v("nonce_str")]),t._v(" 为随机项，用来保证签名的不可预测性。")])]),t._v(" "),e("li",[e("p",[t._v("微信证书的说明\n"),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=4_3",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信证书的作用"),e("OutboundLink")],1)])])])]),t._v(" "),e("li",[t._v("证书要求")]),t._v(" "),e("li",[t._v("逻辑判断\n"),e("ol",[e("li",[t._v("先判断协议字段，错误返回")]),t._v(" "),e("li",[t._v("再判断业务，错误返回")]),t._v(" "),e("li",[t._v("最后判断交易状态，错误返回")])])])]),t._v(" "),e("h1",{attrs:{id:"支付开发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付开发","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付开发")]),t._v(" "),e("h2",{attrs:{id:"支付字段规定"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付字段规定","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付字段规定")]),t._v(" "),e("h3",{attrs:{id:"对应支付选择"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#对应支付选择","aria-hidden":"true"}},[t._v("#")]),t._v(" 对应支付选择")]),t._v(" "),e("p",[t._v("在不同支付场景使用对应开发接口。\n其中选择方式如下。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("使用场景")]),t._v(" "),e("th",[t._v("支付模式")]),t._v(" "),e("th",[t._v("商品字段规则")]),t._v(" "),e("th",[t._v("样例")]),t._v(" "),e("th",[t._v("备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("PC 网站")]),t._v(" "),e("td",[t._v("扫码支付")]),t._v(" "),e("td",[t._v("商品主页-商品描述")]),t._v(" "),e("td",[t._v("qq 会员充值")]),t._v(" "),e("td",[t._v("无")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("微信浏览器")]),t._v(" "),e("td",[t._v("公众号支付")]),t._v(" "),e("td",[t._v("商家名称-销售商品类目")]),t._v(" "),e("td",[t._v("逻辑思维-图书")]),t._v(" "),e("td",[t._v("线上商店，商家名称必须为实际销售商品店家")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("门店扫码")]),t._v(" "),e("td",[t._v("公众号支付")]),t._v(" "),e("td",[t._v("店名-销售商品类目")]),t._v(" "),e("td",[t._v("天虹南山店-超市")]),t._v(" "),e("td",[t._v("线下门店支付")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("门店扫码")]),t._v(" "),e("td",[t._v("扫码支付")]),t._v(" "),e("td",[t._v("店名-销售商品类目")]),t._v(" "),e("td",[t._v("天虹南山店-超市")]),t._v(" "),e("td",[t._v("线下门店支付")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("门店刷卡")]),t._v(" "),e("td",[t._v("刷卡支付")]),t._v(" "),e("td",[t._v("店名-销售商品类目")]),t._v(" "),e("td",[t._v("天虹南山店-超市")]),t._v(" "),e("td",[t._v("线下门店支付")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("第三方手机浏览器")]),t._v(" "),e("td",[t._v("H5 支付")]),t._v(" "),e("td",[t._v("主页 title 名-商品概述")]),t._v(" "),e("td",[t._v("腾讯充值中心-QQ会员充值")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("第三方 APP")]),t._v(" "),e("td",[t._v("APP 支付")]),t._v(" "),e("td",[t._v("应用市场 APP 名-商品概述")]),t._v(" "),e("td",[t._v("天天爱消除-游戏充值")]),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://mp.weixin.qq.com/wiki",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信门店详解"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"金额要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#金额要求","aria-hidden":"true"}},[t._v("#")]),t._v(" 金额要求")]),t._v(" "),e("p",[e("strong",[t._v("微信支付金额限定在对应币种的最小单位")])]),t._v(" "),e("p",[t._v("交易类型")]),t._v(" "),e("ul",[e("li",[t._v("JSAPI-- 公众号支付")]),t._v(" "),e("li",[t._v("NATIVE -- 原生扫码支付")]),t._v(" "),e("li",[t._v("APP -- app 支付，以上利用统一支付接口进行调用")]),t._v(" "),e("li",[t._v("MICROPAY -- 有单独的接口")])]),t._v(" "),e("p",[t._v("货币种类")]),t._v(" "),e("ul",[e("li",[t._v("CNY 人民币")])]),t._v(" "),e("p",[t._v("时间必须为北京时间，精确到秒")]),t._v(" "),e("p",[t._v("商户订单号，由商户自行生成，必须保证唯一性（采用系统时间加随机序列来生成订单号）\n具体规则。\n* 若支付失败重新支付，使用原订单号\n* 已支付或关闭撤销订单需重新生成订单号")]),t._v(" "),e("p",[t._v("银行类型参见下表 "),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_2",target:"_blank",rel:"noopener noreferrer"}},[t._v("参数规定"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_3",target:"_blank",rel:"noopener noreferrer"}},[t._v("证书功能详解"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"支付前期准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付前期准备","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付前期准备")]),t._v(" "),e("p",[t._v("准备工作，必须包含如下条件")]),t._v(" "),e("ul",[e("li",[t._v("有认证了的服务号并且开通了微信支付")]),t._v(" "),e("li",[t._v("获取如下信息写入微信官方 demo 配置文件\n"),e("ul",[e("li",[e("strong",[t._v("AppID")]),t._v(" 绑定微信支付的服务号")]),t._v(" "),e("li",[e("strong",[t._v("AppSecret")]),t._v(" 绑定微信支付的服务号密码")]),t._v(" "),e("li",[e("strong",[t._v("Mch_id")]),t._v(" 商户编号,微信支付->商户信息查看")]),t._v(" "),e("li",[e("strong",[t._v("APIKey")]),t._v(" 商户支付密钥,在微信支付中使用的密钥, 商户 -> api 安全查看")]),t._v(" "),e("li",[e("strong",[t._v("SSLCERT_PATH")])]),t._v(" "),e("li",[e("strong",[t._v("SSLKEY_PATH")])])])])]),t._v(" "),e("p",[t._v("支付开发流程如下")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("配置微信公众平台")]),t._v(" "),e("ol",[e("li",[t._v("开发基本配置保证服务器的正常连接")]),t._v(" "),e("li",[t._v("设置，公众号设置 -> 功能设置中允许域名接口")]),t._v(" "),e("li",[t._v("微信支付中修改支付授权目录和支付回调 url")]),t._v(" "),e("li",[t._v("安装对应证书")])])]),t._v(" "),e("li",[e("p",[t._v("利用参看 "),e("a",{attrs:{href:"https://mp.weixin.qq.com/wiki/17/c0f37d5704f0b64713d5d2c37b468d75.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信授权"),e("OutboundLink")],1),t._v("获取 code")])])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx37bcdb3936e6fb03&connect_redirect=1&redirect_uri=http:%2F%2F1.zsyd.applinzi.com%2FYDPAY%2Fcharge.test.php&response_type=code&scope=snsapi_base&state=STATE",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx37bcdb3936e6fb03&connect_redirect=1&redirect_uri=http:%2F%2F1.zsyd.applinzi.com%2FYDPAY%2Fcharge.test.php&response_type=code&scope=snsapi_base&state=STATE"),e("OutboundLink")],1)]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[e("p",[t._v("利用 code 获取 opneid")])]),t._v(" "),e("li",[e("p",[t._v("利用 openid 生成账单")])]),t._v(" "),e("li",[e("p",[t._v("利用账单调用微信支付接口")])])]),t._v(" "),e("h2",{attrs:{id:"常见坑"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见坑","aria-hidden":"true"}},[t._v("#")]),t._v(" 常见坑")]),t._v(" "),e("h3",{attrs:{id:"redirect-url-错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redirect-url-错误","aria-hidden":"true"}},[t._v("#")]),t._v(" redirect_url 错误")]),t._v(" "),e("p",[t._v("去公众号设置->功能设置中修改文件路径即可\n添加网页授权路径即可.")]),t._v(" "),e("ol",[e("li",[t._v("必须精确到调用支付的文件夹")]),t._v(" "),e("li",[t._v("不允许有 "),e("code",[t._v("_")]),t._v(" 为字符的文件名")]),t._v(" "),e("li",[e("strong",[t._v("支付路径必须和公众号中设置的完全一样,特别是 "),e("code",[t._v("//")]),t._v(" "),e("code",[t._v("/")]),t._v(" 的问题")])])]),t._v(" "),e("h3",{attrs:{id:"不使用微信库如何获取-openid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#不使用微信库如何获取-openid","aria-hidden":"true"}},[t._v("#")]),t._v(" 不使用微信库如何获取 openId")]),t._v(" "),e("p",[t._v("参看 "),e("a",{attrs:{href:"https://mp.weixin.qq.com/wiki/17/c0f37d5704f0b64713d5d2c37b468d75.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信授权"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"MP_verify_aD3mRHUdJlbXazQP.txt"}},[t._v("论坛讨论")])]),t._v(" "),e("h3",{attrs:{id:"支付中路径设置问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付中路径设置问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付中路径设置问题")]),t._v(" "),e("p",[e("img",{attrs:{src:"img/wechatPay.jpg",alt:""}})]),t._v(" "),e("p",[e("a",{attrs:{href:"http://www.mengyunzhi.com/share/develop-en/183-wepay-the-url-not-regestirer.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付路径的坑"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"微信公众号被查封处理步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信公众号被查封处理步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信公众号被查封处理步骤")]),t._v(" "),e("p",[e("a",{attrs:{href:"http://kf.qq.com/faq/170118UnqeUZ170118mUb6fu.html?pass_ticket=EiDyGZ30yCvUm%2Ffl6uysrqp2lByF%2FLonvOC6%2B0tZ9abuf7dQdEbXdZ96xWk2qxSB",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信查封说明"),e("OutboundLink")],1)]),t._v(" "),e("h3",{attrs:{id:"微信支付成功的正确判断"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信支付成功的正确判断","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信支付成功的正确判断")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("正确逻辑"),e("OutboundLink")],1)]),t._v(" "),e("h1",{attrs:{id:"获取用户-openid"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取用户-openid","aria-hidden":"true"}},[t._v("#")]),t._v(" 获取用户 openId")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/micropay.php?chapter=4_4",target:"_blank",rel:"noopener noreferrer"}},[t._v("用户 openId"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("由于在微信体系中，用户 openId 对于不同公众号具有唯一性。\n建议在用户注册阶段直接存入，数据库。方便后续调用。重点。")]),t._v(" "),e("h1",{attrs:{id:"api-详解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#api-详解","aria-hidden":"true"}},[t._v("#")]),t._v(" api 详解")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("接口")]),t._v(" "),e("th",[t._v("功能")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("刷卡支付")]),t._v(" "),e("td",[t._v("需要用户提供授权码")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("查询订单")]),t._v(" "),e("td",[t._v("用来获取支付订单状态")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("撤销订单")]),t._v(" "),e("td",[t._v("撤销订单，再支付成功以内的 7 天均有效，注意在支付 15 s 后才执行次操作")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("退款接口")]),t._v(" "),e("td",[t._v("支持对金额的返回，一年之内有效，")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("退款状态查询")]),t._v(" "),e("td",[t._v("零钱支付 20 分钟内返还，银行卡最长为 3 天时间")])])])]),t._v(" "),e("p",[t._v("采用微信平台进行微信测试")]),t._v(" "),e("p",[e("a",{attrs:{href:"http://www.jianshu.com/p/2cb959529c96#comments",target:"_blank",rel:"noopener noreferrer"}},[t._v("用户充值原理"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"企业付款"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#企业付款","aria-hidden":"true"}},[t._v("#")]),t._v(" 企业付款")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_2",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信企业支付"),e("OutboundLink")],1)])])},[],!1,null,null,null);_.default=r.exports}}]);